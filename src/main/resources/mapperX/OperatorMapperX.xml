<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gzsb.root.gzsbroot.dao.mapperX.OperatorMapperX">

    <resultMap id="BaseResultMap" type="com.gzsb.root.gzsbroot.dao.entityX.SystemOperator">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="OPERATOR" jdbcType="VARCHAR" property="operator"/>
        <result column="PLAN_STATUS_CODE" jdbcType="VARCHAR" property="planStatusCode"/>
        <result column="PASSWORD" jdbcType="VARCHAR" property="password"/>
        <result column="PASSWORD_SALT" jdbcType="VARCHAR" property="passwordSalt"/>
        <result column="CREATE_TIME" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="REAL_NAME" jdbcType="VARCHAR" property="realName"/>
        <result column="JOB_NUM" jdbcType="VARCHAR" property="jobNum"/>
        <result column="PHONE" jdbcType="VARCHAR" property="phone"/>
        <result column="EMAIL" jdbcType="VARCHAR" property="email"/>
    </resultMap>

    <select id="selectOperatorByUsername" resultMap="BaseResultMap">
        SELECT
        OPERATOR,
        PLAN_STATUS_CODE,
        PASSWORD,
        PASSWORD_SALT,
        CREATE_TIME,
        REAL_NAME,
        JOB_NUM,
        PHONE,
        EMAIL
        FROM `GZSB_OPERATOR`

        WHERE OPERATOR =#{username}
    </select>
    <select id="selectRoles" resultType="role">
        select r.* from gzsb_operator_role `or`
         LEFT JOIN gzsb_role r
        ON r.ROLE_CODE = `or`.ROLE_CODE
        WHERE `or`.OPERATOR = #{OPERATOR}
    </select>
    <resultMap id="operatorMap" type="operator">
        <id column="OPERATOR" property="operator"/>
        <collection property="role" ofType="Role" select="selectRoles" column="OPERATOR">

        </collection>
    </resultMap>
    <select id="selectOperatorFindAll" resultMap="operatorMap">
        SELECT o.*,d.DEPARTMENT_NAME,dp.* FROM gzsb_operator o
        LEFT JOIN gzsb_operator_position op
        ON o.OPERATOR = op.OPERATOR
        LEFT JOIN gzsb_department_position dp
        ON dp.POSITION_ID = op.POSITION_ID
        LEFT JOIN gzsb_department d
        ON d.DEPARTMENT_CODE = dp.DEPARTMENT_CODE
        <where>
            <if test="departmentCode != null and departmentCode != ''">
                and d.DEPARTMENT_CODE = #{departmentCode}
            </if>
            <if test="realName != null and realName != ''">
                and o.REAL_NAME like "%"#{realName}"%"
            </if>
            <if test="planStatusCode != null and planStatusCode != ''">
                and PLAN_STATUS_CODE = #{planStatusCode}
            </if>
        </where>
    </select>


    <update id="updatePassword" parameterType="String">
        UPDATE GZSB_OPERATOR SET
        PASSWORD = #{passwordTow,jdbcType=VARCHAR} WHERE PASSWORD = #{password} AND OPERATOR = #{operator}
    </update>

    <select id="findOperatorByCode" resultType="Operator">
      SELECT * FROM gzsb_operator where OPERATOR = #{operator}
    </select>

    <select id="findOperatorByJobNum" resultType="Integer">
        SELECT count(*) FROM gzsb_operator where JOB_NUM = #{jobNum}
    </select>


</mapper>